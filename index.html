<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
  <title>Factura MÃ³vil</title>
  <link rel="stylesheet" href="styles.css"/>
  <!-- Libs -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.11.11/dayjs.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.11.11/locale/es.min.js" defer></script>
  <!-- App -->
  <script src="app.js" defer></script>
</head>
<body>
<header class="app-header">
  <div class="brand">
    <img id="brandLogo" src="assets/logo-placeholder.png" alt="logo"/>
    <div>
      <h1 id="brandName">Oasis Air Cleaner Services</h1>
      <small id="brandEmail">osiservicespr@gmail.com</small>
    </div>
  </div>
  <button class="btn" id="btnHomeTop" type="button">Inicio</button>
</header>

<main>
  <!-- HOME -->
  <section id="view-home" class="view active" aria-hidden="false">
    <h2>Panel principal</h2>
    <div class="cards">
      <button class="card" id="goNewInvoice" type="button"><span>â•</span><b>Nueva factura</b><small>Crea y exporta</small></button>
      <button class="card" id="goHistory"    type="button"><span>ğŸ“œ</span><b>Historial</b><small>Facturas guardadas</small></button>
      <button class="card" id="goClients"    type="button"><span>ğŸ‘¤</span><b>Clientes</b><small>Agenda rÃ¡pida</small></button>
      <button class="card" id="goConfig"     type="button"><span>âš™ï¸</span><b>ConfiguraciÃ³n</b><small>Logo, datos y pagos</small></button>
      <button class="card" id="goCatalog"    type="button"><span>ğŸ“¦</span><b>CatÃ¡logo</b><small>Productos y servicios</small></button>
      <button class="card" id="goQuickPay"   type="button"><span>ğŸ’³</span><b>Pagos rÃ¡pidos</b><small>Stripe/PayPal</small></button>
      <button class="card" id="goReports"    type="button"><span>ğŸ“ˆ</span><b>Reportes</b><small>Mes y clientes</small></button>
      <button class="card" id="goTemplates"  type="button"><span>ğŸ“</span><b>Notas rÃ¡pidas</b><small>Insertar en factura</small></button>
      <button class="card" id="goWhats"      type="button"><span>ğŸŸ¢</span><b>WhatsApp</b><small>Enviar cobro</small></button>
      <button class="card" id="goBackup"     type="button"><span>ğŸ’¾</span><b>Respaldo</b><small>Exportar/Importar</small></button>
    </div>
  </section>

  <!-- FACTURA -->
  <section id="view-invoice" class="view" aria-hidden="true">
    <div class="toolbar"><button class="btn ghost backHome" type="button">&larr; Volver</button><h2>Nueva factura</h2></div>
    <form id="invoiceForm" onsubmit="return false;">
      <div class="row"><label>NÃºmero</label>
        <div class="row-inline"><input id="invPrefix" class="sm" value="FAC-"/><input id="invNumber" class="sm" type="number" min="1" value="1"/></div>
      </div>
      <div class="row"><label>Cliente</label>
        <div class="row-inline">
          <select id="clientSelect"></select>
          <button id="addClientInline" class="btn" type="button">+ Cliente</button>
          <button id="pickContactInline" class="btn" type="button">Importar contacto</button>
        </div>
      </div>
      <div class="row two">
        <div><label>Fecha</label><input id="invDate" type="date"/></div>
        <div><label>Vence</label><input id="invDue" type="date"/></div>
      </div>
      <div class="row">
        <label>Conceptos</label>
        <table class="lines">
          <thead><tr><th>DescripciÃ³n</th><th class="n">Cant.</th><th class="n">Precio</th><th class="n">Total</th><th></th></tr></thead>
          <tbody id="linesBody"></tbody>
        </table>
        <div class="row-inline">
          <button id="addLine" class="btn" type="button">+ LÃ­nea</button>
          <button id="fromCatalog" class="btn" type="button">AÃ±adir del catÃ¡logo</button>
        </div>
      </div>
      <div class="row two">
        <div><label>Descuento %</label><input id="discPct" type="number" min="0" step="0.01" value="0"/></div>
        <div><label>Impuesto %</label><input id="taxPct" type="number" min="0" step="0.01" value="11.5"/></div>
      </div>
      <div class="totals">
        <div><span>Subtotal</span><b id="tSubtotal">$0.00</b></div>
        <div><span>Descuento</span><b id="tDiscount">$0.00</b></div>
        <div><span>Impuesto</span><b id="tTax">$0.00</b></div>
        <div class="total"><span>Total</span><b id="tTotal">$0.00</b></div>
      </div>
      <div class="row">
        <label>Enlace de pago</label>
        <div class="row-inline"><input id="payLink" placeholder="Pega tu Payment Link"/><button id="btnPickPayLink" class="btn" type="button">AÃ±adir enlace</button></div>
        <small class="muted">Administra enlaces en ConfiguraciÃ³n â†’ Enlaces de pago.</small>
      </div>
      <div class="row"><label>Notas</label><textarea id="invNotes" rows="3" placeholder="Gracias por su negocio."></textarea></div>
      <div class="actions">
        <button id="btnSave" class="btn primary" type="button">Guardar</button>
        <button id="btnPDF" class="btn" type="button">Exportar PDF</button>
        <button id="btnClear" class="btn ghost" type="button">Limpiar</button>
      </div>
    </form>
  </section>

  <!-- HISTORIAL -->
  <section id="view-history" class="view" aria-hidden="true">
    <div class="toolbar"><button class="btn ghost backHome" type="button">&larr; Volver</button><h2>Historial</h2></div>
    <div class="panel" style="margin-bottom:10px">
      <div class="row two">
        <div><label>Mes</label><select id="histMonth"></select></div>
        <div><label>Total facturado (USD)</label><input id="histTotal" readonly/></div>
      </div>
    </div>
    <div id="historyList" class="list"></div>
  </section>

  <!-- CLIENTES -->
  <section id="view-clients" class="view" aria-hidden="true">
    <div class="toolbar"><button class="btn ghost backHome" type="button">&larr; Volver</button><h2>Clientes</h2></div>

    <!-- Buscador -->
    <div class="panel" style="margin-bottom:10px">
      <div class="row two">
        <div>
          <label>Buscar</label>
          <input id="clientSearch" placeholder="Nombre, email, telÃ©fono o direcciÃ³n"/>
        </div>
        <div>
          <label>&nbsp;</label>
          <button id="clientClearSearch" class="btn" type="button">Limpiar</button>
        </div>
      </div>
      <small class="muted" id="clientCountHint">0 clientes</small>
    </div>

    <form id="clientForm" class="panel" onsubmit="return false;">
      <div class="row two">
        <div><label>Nombre</label><input id="cName" required/></div>
        <div><label>Email</label><input id="cEmail" type="email"/></div>
      </div>
      <div class="row two">
        <div><label>TelÃ©fono</label><input id="cPhone" inputmode="tel" pattern="[0-9+ ()-]*"/></div>
        <div><label>DirecciÃ³n</label><input id="cAddress"/></div>
      </div>
      <div class="row"><button id="saveClient" class="btn primary" type="button">Guardar cliente</button></div>
      <div class="row"><button id="importFromContacts" class="btn" type="button">Importar desde Contactos</button></div>
      <div class="row">
        <button id="importVCF" class="btn" type="button">Importar vCard (.vcf)</button>
        <input id="vcfInput" type="file" accept=".vcf,text/vcard" style="display:none"/>
        <small class="muted" id="contactSupportHint">En iPhone comparte el contacto como vCard y cÃ¡rgalo aquÃ­.</small>
      </div>
    </form>
    <div id="clientsList" class="list"></div>
  </section>

  <!-- CONFIGURACIÃ“N -->
  <section id="view-config" class="view" aria-hidden="true">
    <div class="toolbar"><button class="btn ghost backHome" type="button">&larr; Volver</button><h2>ConfiguraciÃ³n</h2></div>
    <div class="panel">
      <div class="row"><label>Nombre comercial</label><input id="cfgName" value="Oasis Air Cleaner Services"/></div>
      <div class="row"><label>Email de contacto</label><input id="cfgEmail" value="osiservicespr@gmail.com"/></div>
      <div class="row"><label>Logo (PNG/JPG)</label><input id="cfgLogo" type="file" accept="image/png,image/jpeg"/><small class="muted">Se guarda localmente.</small></div>
      <div class="row"><button id="saveConfig" class="btn primary" type="button">Guardar configuraciÃ³n</button></div>
    </div>
    <div class="panel">
      <h3 style="margin-top:0">Enlaces de pago</h3>
      <div class="row two">
        <div><label>Nombre</label><input id="plName" placeholder="Stripe / PayPal"/></div>
        <div><label>URL</label><input id="plUrl" placeholder="https://..."/></div>
      </div>
      <div class="row"><button id="addPayLink" class="btn primary" type="button">Agregar enlace</button></div>
      <div id="payLinksList" class="list"></div>
      <small class="muted">Marca uno como <b>Predeterminado</b>.</small>
    </div>
  </section>

  <!-- CATÃLOGO -->
  <section id="view-catalog" class="view" aria-hidden="true">
    <div class="toolbar"><button class="btn ghost backHome" type="button">&larr; Volver</button><h2>CatÃ¡logo</h2></div>
    <div class="panel">
      <div class="row two">
        <div><label>Nombre</label><input id="pName"/></div>
        <div><label>Precio</label><input id="pPrice" type="number" step="0.01" min="0"/></div>
      </div>
      <div class="row"><button id="addProduct" class="btn primary" type="button">Guardar</button></div>
    </div>
    <div id="productList" class="list"></div>
  </section>

  <!-- PAGOS RÃPIDOS -->
  <section id="view-quickpay" class="view" aria-hidden="true">
    <div class="toolbar"><button class="btn ghost backHome" type="button">&larr; Volver</button><h2>Pagos rÃ¡pidos</h2></div>
    <div class="panel">
      <div class="row two">
        <div><label>Enlace</label><select id="qpLink"></select></div>
        <div><label>Monto (USD)</label><input id="qpAmount" type="number" step="0.01" min="0"/></div>
      </div>
      <div class="row-inline">
        <button id="qpOpen" class="btn primary" type="button">Abrir pago</button>
        <button id="qpCopy" class="btn" type="button">Copiar enlace</button>
      </div>
      <small class="muted">El monto no siempre se auto-llena (depende del proveedor).</small>
    </div>
    <div id="qpInfo" class="panel"></div>
  </section>

  <!-- REPORTES -->
  <section id="view-reports" class="view" aria-hidden="true">
    <div class="toolbar"><button class="btn ghost backHome" type="button">&larr; Volver</button><h2>Reportes</h2></div>
    <div class="panel"><div class="row"><label>Resumen por mes</label></div><div id="repMonths" class="list"></div></div>
    <div class="panel"><div class="row"><label>Top clientes (total facturado)</label></div><div id="repClients" class="list"></div></div>
  </section>

  <!-- NOTAS RÃPIDAS -->
  <section id="view-templates" class="view" aria-hidden="true">
    <div class="toolbar"><button class="btn ghost backHome" type="button">&larr; Volver</button><h2>Notas rÃ¡pidas</h2></div>
    <div class="panel">
      <div class="row two">
        <div><label>TÃ­tulo</label><input id="tnTitle"/></div>
        <div><label>â€”</label><button id="tnSave" class="btn primary" type="button">Guardar</button></div>
      </div>
      <div class="row"><label>Contenido</label><textarea id="tnBody" rows="4" placeholder="Ej: TÃ©rminos y condicionesâ€¦"></textarea></div>
    </div>
    <div id="tnList" class="list"></div>
  </section>

  <!-- WHATSAPP -->
  <section id="view-whats" class="view" aria-hidden="true">
    <div class="toolbar"><button class="btn ghost backHome" type="button">&larr; Volver</button><h2>WhatsApp</h2></div>
    <div class="panel">
      <div class="row">
        <label>Factura (opcional)</label>
        <select id="waInvoice"></select>
        <small class="muted">Si eliges una, se usa su total, cliente y enlace de pago.</small>
      </div>
      <div class="row two">
        <div><label>TelÃ©fono destino</label><input id="waPhone" inputmode="tel" placeholder="+1787..."/></div>
        <div><label>Total manual (opcional)</label><input id="waAmount" type="number" step="0.01" min="0" placeholder="0.00"/></div>
      </div>
      <div class="row"><label>Enlace de pago (opcional)</label><input id="waLink" placeholder="Se autollenarÃ¡ si la factura lo tiene"/></div>
      <div class="row"><label>Mensaje</label><textarea id="waText" rows="4"></textarea></div>
      <div class="actions">
        <button id="waBuild" class="btn" type="button">Generar mensaje</button>
        <button id="waOpen"  class="btn primary" type="button">Abrir WhatsApp</button>
        <button id="waCopy"  class="btn" type="button">Copiar mensaje</button>
      </div>
    </div>
  </section>

  <!-- RESPALDO -->
  <section id="view-backup" class="view" aria-hidden="true">
    <div class="toolbar"><button class="btn ghost backHome" type="button">&larr; Volver</button><h2>Respaldo</h2></div>
    <div class="panel">
      <div class="row-inline">
        <button id="bkExport" class="btn primary" type="button">Exportar .json</button>
        <button id="bkImportBtn" class="btn" type="button">Importar .json</button>
        <input id="bkFile" type="file" accept="application/json" style="display:none"/>
      </div>
      <small class="muted">Incluye facturas, clientes, catÃ¡logo, notas, enlaces, empresa y logo.</small>
    </div>
  </section>
</main>

<nav class="bottom-nav">
  <button data-target="view-home" class="active" type="button">ğŸ </button>
  <button data-target="view-invoice" type="button">ğŸ§¾</button>
  <button data-target="view-history" type="button">ğŸ“œ</button>
  <button data-target="view-clients" type="button">ğŸ‘¤</button>
  <button data-target="view-config" type="button">âš™ï¸</button>
</nav>

<!-- Modales -->
<div class="modal-backdrop" id="modalPL" style="display:none">
  <div class="modal"><h3>Selecciona un enlace de pago</h3><div id="modalPLList" class="list" style="margin:10px 0 14px"></div>
    <div style="display:flex;gap:8px;justify-content:flex-end"><button id="modalPLClose" class="btn ghost" type="button">Cerrar</button></div>
  </div>
</div>
<div class="modal-backdrop" id="modalClient" style="display:none">
  <div class="modal">
    <h3>Nuevo cliente</h3>
    <form id="quickClientForm" onsubmit="return false;">
      <div class="row two">
        <div><label>Nombre</label><input id="qcName" required/></div>
        <div><label>Email</label><input id="qcEmail" type="email"/></div>
      </div>
      <div class="row two">
        <div><label>TelÃ©fono</label><input id="qcPhone" inputmode="tel" pattern="[0-9+ ()-]*"/></div>
        <div><label>DirecciÃ³n</label><input id="qcAddress"/></div>
      </div>
    </form>
    <div style="display:flex;gap:8px;justify-content:flex-end">
      <button class="btn ghost" id="qcCancel" type="button">Cancelar</button>
      <button class="btn primary" id="qcSave" type="button">Guardar</button>
    </div>
  </div>
</div>
</body>
</html>
