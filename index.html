<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
  <title>Factura M√≥vil</title>
  <link rel="stylesheet" href="styles.css"/>

  <!-- Librer√≠as -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.11.11/dayjs.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.11.11/locale/es.min.js" defer></script>

  <!-- App -->
  <script src="app.js" defer></script>
</head>
<body>
  <header class="app-header">
    <div class="brand">
      <img id="brandLogo" src="assets/logo-placeholder.png" alt="logo"/>
      <div>
        <h1 id="brandName">Mi Empresa</h1>
        <small id="brandEmail">correo@empresa.com</small>
      </div>
    </div>
    <button class="btn" id="btnHomeTop" type="button">Inicio</button>
  </header>

  <main>
    <!-- HOME -->
    <section id="view-home" class="view active" aria-hidden="false">
      <h2>Panel principal</h2>

      <!-- fila 1 (ya existentes) -->
      <div class="cards">
        <button class="card" id="goNewInvoice" type="button" aria-controls="view-invoice">
          <span>‚ûï</span><b>Nueva factura</b><small>Crea y exporta</small>
        </button>
        <button class="card" id="goHistory" type="button" aria-controls="view-history">
          <span>üìú</span><b>Historial</b><small>Facturas guardadas</small>
        </button>
        <button class="card" id="goClients" type="button" aria-controls="view-clients">
          <span>üë§</span><b>Clientes</b><small>Agenda r√°pida</small>
        </button>
        <button class="card" id="goConfig" type="button" aria-controls="view-config">
          <span>‚öôÔ∏è</span><b>Configuraci√≥n</b><small>Logo, datos y pagos</small>
        </button>

        <!-- fila 2 (NUEVOS) -->
        <button class="card" id="goCatalog" type="button" aria-controls="view-catalog">
          <span>üì¶</span><b>Cat√°logo</b><small>Productos/servicios</small>
        </button>
        <button class="card" id="goQuickPay" type="button" aria-controls="view-quickpay">
          <span>üí≥</span><b>Cobro r√°pido</b><small>Link de pago</small>
        </button>
        <button class="card" id="goReports" type="button" aria-controls="view-reports">
          <span>üìà</span><b>Reportes</b><small>Totales por mes</small>
        </button>
        <button class="card" id="goSign" type="button" aria-controls="view-sign">
          <span>‚úçÔ∏è</span><b>Firma</b><small>Firma para PDF</small>
        </button>
      </div>
    </section>

    <!-- FACTURA -->
    <section id="view-invoice" class="view" aria-hidden="true">
      <div class="toolbar">
        <button class="btn ghost backHome" type="button">&larr; Volver</button>
        <h2>Nueva factura</h2>
      </div>

      <form id="invoiceForm" onsubmit="return false;">
        <div class="row">
          <label>N√∫mero</label>
          <div class="row-inline">
            <input id="invPrefix" class="sm" value="FAC-"/>
            <input id="invNumber" class="sm" type="number" min="1" value="1"/>
          </div>
        </div>

        <div class="row">
          <label>Cliente</label>
          <div class="row-inline">
            <select id="clientSelect"></select>
            <button id="addClientInline" class="btn" type="button">+ Cliente</button>
            <button id="pickContactInline" class="btn" type="button">Importar contacto</button>
          </div>
        </div>

        <div class="row two">
          <div>
            <label>Fecha</label>
            <input id="invDate" type="date"/>
          </div>
          <div>
            <label>Vence</label>
            <input id="invDue" type="date"/>
          </div>
        </div>

        <div class="row">
          <label>Conceptos</label>
          <table class="lines">
            <thead>
              <tr><th>Descripci√≥n</th><th class="n">Cant.</th><th class="n">Precio</th><th class="n">Total</th><th></th></tr>
            </thead>
            <tbody id="linesBody"></tbody>
          </table>
          <button id="addLine" class="btn" type="button">+ L√≠nea</button>
        </div>

        <div class="row two">
          <div>
            <label>Descuento %</label>
            <input id="discPct" type="number" min="0" step="0.01" value="0"/>
          </div>
          <div>
            <label>Impuesto %</label>
            <input id="taxPct" type="number" min="0" step="0.01" value="11.5"/>
          </div>
        </div>

        <div class="totals">
          <div><span>Subtotal</span><b id="tSubtotal">$0.00</b></div>
          <div><span>Descuento</span><b id="tDiscount">$0.00</b></div>
          <div><span>Impuesto</span><b id="tTax">$0.00</b></div>
          <div class="total"><span>Total</span><b id="tTotal">$0.00</b></div>
        </div>

        <div class="row">
          <label>Enlace de pago</label>
          <div class="row-inline">
            <input id="payLink" placeholder="Pega tu Payment Link (Stripe/PayPal)"/>
            <button id="btnPickPayLink" class="btn" type="button">A√±adir enlace</button>
          </div>
          <small class="muted">Administra enlaces en <b>Configuraci√≥n ‚Üí Enlaces de pago</b>.</small>
        </div>

        <div class="row">
          <label>Notas</label>
          <textarea id="invNotes" rows="3" placeholder="Gracias por su negocio."></textarea>
        </div>

        <div class="actions">
          <button id="btnSave" class="btn primary" type="button">Guardar</button>
          <button id="btnPDF" class="btn" type="button">Exportar PDF</button>
          <button id="btnClear" class="btn ghost" type="button">Limpiar</button>
        </div>
      </form>
    </section>

    <!-- HISTORIAL -->
    <section id="view-history" class="view" aria-hidden="true">
      <div class="toolbar">
        <button class="btn ghost backHome" type="button">&larr; Volver</button>
        <h2>Historial</h2>
      </div>

      <!-- RESUMEN MENSUAL -->
      <div class="panel" style="margin-bottom:10px">
        <div class="row two">
          <div>
            <label>Mes</label>
            <select id="histMonth"></select>
          </div>
          <div>
            <label>Total facturado (USD)</label>
            <input id="histTotal" readonly />
          </div>
        </div>
      </div>

      <div id="historyList" class="list"></div>
    </section>

    <!-- CLIENTES -->
    <section id="view-clients" class="view" aria-hidden="true">
      <div class="toolbar">
        <button class="btn ghost backHome" type="button">&larr; Volver</button>
        <h2>Clientes</h2>
      </div>

      <form id="clientForm" class="panel" onsubmit="return false;">
        <div class="row two">
          <div>
            <label>Nombre</label>
            <input id="cName" required/>
          </div>
          <div>
            <label>Email</label>
            <input id="cEmail" type="email"/>
          </div>
        </div>
        <div class="row two">
          <div>
            <label>Tel√©fono</label>
            <input id="cPhone" inputmode="tel" pattern="[0-9+ ()-]*"/>
          </div>
          <div>
            <label>Direcci√≥n</label>
            <input id="cAddress"/>
          </div>
        </div>
        <div class="row">
          <button id="saveClient" class="btn primary" type="button">Guardar cliente</button>
        </div>

        <div class="row">
          <button id="importFromContacts" class="btn" type="button">Importar desde Contactos</button>
        </div>

        <!-- Fallback vCard para iOS -->
        <div class="row">
          <button id="importVCF" class="btn" type="button">Importar vCard (.vcf)</button>
          <input id="vcfInput" type="file" accept=".vcf,text/vcard" style="display:none"/>
          <small class="muted" id="contactSupportHint">
            En iPhone, comparte el contacto como vCard desde la app Contactos y c√°rgalo aqu√≠.
          </small>
        </div>
      </form>

      <div id="clientsList" class="list"></div>
    </section>

    <!-- CONFIGURACI√ìN -->
    <section id="view-config" class="view" aria-hidden="true">
      <div class="toolbar">
        <button class="btn ghost backHome" type="button">&larr; Volver</button>
        <h2>Configuraci√≥n</h2>
      </div>

      <div class="panel">
        <div class="row">
          <label>Nombre comercial</label>
          <input id="cfgName" value="Mi Empresa"/>
        </div>
        <div class="row">
          <label>Email de contacto</label>
          <input id="cfgEmail" value="correo@empresa.com"/>
        </div>
        <div class="row">
          <label>Logo (PNG/JPG)</label>
          <input id="cfgLogo" type="file" accept="image/png,image/jpeg"/>
          <small class="muted">Se guarda localmente (base64).</small>
        </div>
        <div class="row">
          <button id="saveConfig" class="btn primary" type="button">Guardar configuraci√≥n</button>
        </div>
      </div>

      <div class="panel">
        <h3 style="margin-top:0">Enlaces de pago</h3>
        <div class="row two">
          <div>
            <label>Nombre del enlace</label>
            <input id="plName" placeholder="Stripe / PayPal"/>
          </div>
          <div>
            <label>URL</label>
            <input id="plUrl" placeholder="https://..."/>
          </div>
        </div>
        <div class="row">
          <button id="addPayLink" class="btn primary" type="button">Agregar enlace</button>
        </div>
        <div id="payLinksList" class="list"></div>
        <small class="muted">Marca uno como <b>Predeterminado</b> para auto-llenar al crear factura.</small>
      </div>
    </section>

    <!-- NUEVOS: CAT√ÅLOGO -->
    <section id="view-catalog" class="view" aria-hidden="true">
      <div class="toolbar">
        <button class="btn ghost backHome" type="button">&larr; Volver</button>
        <h2>Cat√°logo</h2>
      </div>
      <div class="panel">
        <div class="row two">
          <div>
            <label>Producto/Servicio</label>
            <input id="itName" placeholder="Descripci√≥n"/>
          </div>
          <div>
            <label>Precio</label>
            <input id="itPrice" type="number" step="0.01" min="0" placeholder="0.00"/>
          </div>
        </div>
        <div class="row">
          <button id="itAdd" class="btn primary" type="button">Guardar en cat√°logo</button>
        </div>
      </div>
      <div id="itList" class="list"></div>
    </section>

    <!-- NUEVO: COBRO R√ÅPIDO -->
    <section id="view-quickpay" class="view" aria-hidden="true">
      <div class="toolbar">
        <button class="btn ghost backHome" type="button">&larr; Volver</button>
        <h2>Cobro r√°pido</h2>
      </div>
      <div class="panel">
        <div class="row">
          <label>Selecciona un Payment Link guardado</label>
          <select id="qpLink"></select>
        </div>
        <div class="row two">
          <div>
            <label>Monto (opcional)</label>
            <input id="qpAmount" type="number" step="0.01" min="0" placeholder="Ej. 125.00"/>
          </div>
          <div>
            <label>Generado</label>
            <input id="qpResult" readonly/>
          </div>
        </div>
        <div class="actions">
          <button id="qpGenerate" class="btn primary" type="button">Generar</button>
          <button id="qpCopy" class="btn" type="button">Copiar</button>
          <small class="muted">El monto se agrega como <code>?amount=</code> al final (algunos proveedores lo ignoran; √∫til como referencia).</small>
        </div>
      </div>
    </section>

    <!-- NUEVO: REPORTES -->
    <section id="view-reports" class="view" aria-hidden="true">
      <div class="toolbar">
        <button class="btn ghost backHome" type="button">&larr; Volver</button>
        <h2>Reportes</h2>
      </div>
      <div class="panel">
        <div class="row">
          <label>√öltimos 6 meses</label>
          <div id="repTable" class="list"></div>
        </div>
      </div>
    </section>

    <!-- NUEVO: FIRMA -->
    <section id="view-sign" class="view" aria-hidden="true">
      <div class="toolbar">
        <button class="btn ghost backHome" type="button">&larr; Volver</button>
        <h2>Firma</h2>
      </div>
      <div class="panel">
        <canvas id="signPad" width="600" height="220" style="width:100%;border:1px dashed #e5e7eb;border-radius:10px;background:#fff"></canvas>
        <div class="actions">
          <button id="signClear" class="btn ghost" type="button">Borrar</button>
          <button id="signSave"  class="btn primary" type="button">Guardar firma</button>
        </div>
        <small class="muted">Si hay firma guardada, se insertar√° autom√°ticamente al final del PDF.</small>
      </div>
    </section>
  </main>

  <nav class="bottom-nav">
    <button data-target="view-home" class="active" type="button">üè†</button>
    <button data-target="view-invoice" type="button">üßæ</button>
    <button data-target="view-history" type="button">üìú</button>
    <button data-target="view-clients" type="button">üë§</button>
    <button data-target="view-config" type="button">‚öôÔ∏è</button>
  </nav>

  <!-- MODAL enlaces de pago -->
  <div class="modal-backdrop" id="modalPL" style="display:none">
    <div class="modal">
      <h3>Selecciona un enlace de pago</h3>
      <div id="modalPLList" class="list" style="margin:10px 0 14px"></div>
      <div style="display:flex;gap:8px;justify-content:flex-end">
        <button id="modalPLClose" class="btn ghost" type="button">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- MODAL: A√±adir cliente r√°pido -->
  <div class="modal-backdrop" id="modalClient" style="display:none">
    <div class="modal">
      <h3>Nuevo cliente</h3>
      <form id="quickClientForm" onsubmit="return false;">
        <div class="row two">
          <div>
            <label>Nombre</label>
            <input id="qcName" required />
          </div>
          <div>
            <label>Email</label>
            <input id="qcEmail" type="email" />
          </div>
        </div>
        <div class="row two">
          <div>
            <label>Tel√©fono</label>
            <input id="qcPhone" inputmode="tel" pattern="[0-9+ ()-]*"/>
          </div>
          <div>
            <label>Direcci√≥n</label>
            <input id="qcAddress" />
          </div>
        </div>
      </form>
      <div style="display:flex;gap:8px;justify-content:flex-end">
        <button class="btn ghost" id="qcCancel" type="button">Cancelar</button>
        <button class="btn primary" id="qcSave" type="button">Guardar</button>
      </div>
    </div>
  </div>
</body>
</html>
